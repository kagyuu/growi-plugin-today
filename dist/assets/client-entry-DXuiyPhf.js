const R="growi-plugin-amazon-embed",U="1.0.0",S="GROWI plugin for embed amazon",T="MIT",N=["growi","growi-plugin"],E="module",G={dev:"vite",build:"tsc && vite build",preview:"vite preview"},L={react:"^18.3.1","react-dom":"^18.3.1","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},O={"@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0",jest:"^29.7.0",typescript:"^5.5.2",vite:"^5.3.2"},M={schemaVersion:"4",types:["script"]},W={name:R,version:U,description:S,license:T,keywords:N,type:E,scripts:G,dependencies:L,devDependencies:O,growiPlugin:M},I=function(n){if(n==null)return X;if(typeof n=="function")return y(n);if(typeof n=="object")return Array.isArray(n)?q(n):B(n);if(typeof n=="string")return D(n);throw new Error("Expected function, string, or object as test")};function q(n){const t=[];let e=-1;for(;++e<n.length;)t[e]=I(n[e]);return y(r);function r(...o){let i=-1;for(;++i<t.length;)if(t[i].apply(this,o))return!0;return!1}}function B(n){const t=n;return y(e);function e(r){const o=r;let i;for(i in n)if(o[i]!==t[i])return!1;return!0}}function D(n){return y(t);function t(e){return e&&e.type===n}}function y(n){return t;function t(e,r,o){return!!(_(e)&&n.call(this,e,typeof r=="number"?r:void 0,o||void 0))}}function X(){return!0}function _(n){return n!==null&&typeof n=="object"&&"type"in n}const P=[],H=!0,v=!1,K="skip";function V(n,t,e,r){let o;typeof t=="function"&&typeof e!="function"?(r=e,e=t):o=t;const i=I(o),s=r?-1:1;f(n,void 0,[])();function f(c,m,u){const l=c&&typeof c=="object"?c:{};if(typeof l.type=="string"){const a=typeof l.tagName=="string"?l.tagName:typeof l.name=="string"?l.name:void 0;Object.defineProperty(w,"name",{value:"node ("+(c.type+(a?"<"+a+">":""))+")"})}return w;function w(){let a=P,d,p,b;if((!t||i(c,m,u[u.length-1]||void 0))&&(a=J(e(c,u)),a[0]===v))return a;if("children"in c&&c.children){const h=c;if(h.children&&a[0]!==K)for(p=(r?h.children.length:-1)+s,b=u.concat(h);p>-1&&p<h.children.length;){const F=h.children[p];if(d=f(F,p,b)(),d[0]===v)return d;p=typeof d[1]=="number"?d[1]:p+s}}return a}}}function J(n){return Array.isArray(n)?n:typeof n=="number"?[H,n]:n==null?P:[n]}function Q(n,t,e,r){let o,i,s;typeof t=="function"&&typeof e!="function"?(i=void 0,s=t,o=e):(i=t,s=e,o=r),V(n,i,f,o);function f(c,m){const u=m[m.length-1],l=u?u.children.indexOf(c):void 0;return s(c,l,u)}}const A=function(){return n=>{Q(n,t=>{const e=t;if(e.name!=="amazon")return;console.log("amazon plugin:",e);const r=e.attributes.asin,o=e.attributes.title,i=e.attributes.url,s="amazon-"+Math.random().toString(36).slice(2);e.type="html",e.value=`<div id="${s}"></div>`;const f=setInterval(()=>{document.querySelector("#"+s)!=null&&(document.querySelector("#"+s).innerHTML=tn(r,o,i),clearInterval(f))},100)})}},Y=n=>{try{const t=new URL(n);if(t.host==="www.amazon.co.jp"){const e=t.pathname.split("/")[3];if(e)return e}}catch{}return""},Z=n=>{try{const t=new URL(n);if(t.host==="www.amazon.co.jp"){const e=decodeURI(t.pathname.split("/")[1]);if(e)return e}}catch{}return""},k=n=>{const t="978"+n.substring(0,9);return t+$(t)},nn=n=>{const t=n.substring(3,12);return t+x(t)},z=n=>n.endsWith(x(n)),j=n=>n.endsWith($(n)),x=n=>{let t=0;for(let r=0;r<9;r++)t=t+(n.charCodeAt(r)-48)*(10-r);const e=11-t%11;return e==10?"X":String.fromCharCode(48+e)},$=n=>{var t=0;for(let r=0;r<12;r++)t=t+(n.charCodeAt(r)-48)*(r%2==0?1:3);const e=10-t%10;return String.fromCharCode(48+e)},tn=function(n,t,e){if(e){const r=Y(e),o=Z(e);if(z(r)){const i=k(r);return g(i,t||o,e)}else return j(r)?g(r,t||o,e):C(r,t||o,e)}if(z(n)){const r=k(n),o=`https://www.amazon.co.jp/dp/${n}`;return g(r,t,o)}else if(j(n)){const o=`https://www.amazon.co.jp/dp/${nn(n)}`;return g(n,t,o)}else{const r=`https://www.amazon.co.jp/dp/${n}`;return C(n,t,r)}},g=function(n,t,e){const r=[];return r.push('<div class="amazon">'),r.push(`<a href="${e}">`),r.push(`<img src="https://img.hanmoto.com/bd/img/${n}.jpg"/>`),r.push("<br>"),r.push(`${t||n}`),r.push("</a>"),r.push("</div>"),r.join("")},C=function(n,t,e){const r=[];return r.push('<div class="amazon">'),r.push(`<a href="${e}">`),r.push(`${t||n}`),r.push("</a>"),r.push("</div>"),r.join("")},en=()=>{if(growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:n}=growiFacade.markdownRenderer;n.customGenerateViewOptions=(...t)=>{const e=n.generateViewOptions(...t);return e.remarkPlugins.push(A),e},n.customGeneratePreviewOptions=(...t)=>{const e=n.generatePreviewOptions(...t);return e.remarkPlugins.push(A),e}},rn=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[W.name]={activate:en,deactivate:rn};
